# Parser

Парсинг новостных страниц с получением заголовка, текста новости и ссылки на новость.

## Переменные окружения

В проекте используются переменный окружения, для более гибкого запуска проекта с разными параметрами запуска.

```LISTEN```  - Порт на котором запускаете проект.

```DB_HOST``` - Хост подключения к базе данных.

```DB_PORT``` - Порт подключения к базе данных.

```DB_USER``` - Пользователь, подключающийса к базе данных.

```DB_PASSWORD``` - Пароль для подключения в базу данных.

```DB_NAME``` - Название базы данных.

```DELAY``` - Указание задержки для посещения дочерних страниц (в секундах).

Проект запускается по команде ```go run ./cmd/api/main.go```.

Проект запустится с дефолтными настройками которые указаны в файле ```/config/config.go```.

Для того, чтобы запустить проект с другими параметрами, необходимо указать название переменной окружения и задать ей
значение.

Например:

```LISTEN=3333 DB_HOST=unlocal DB_PORT=5433 go run ./cmd/api/main.go ```

После выполнения данной команду запуска, проект запуститься на 3333 порту с измененными данными подключения к базе данных.

## Описание полей запроса

```link``` - Ссылка на основную страницу новостного сайта.

```url_is_not_full``` - Флаг, который отвечает, полные ли дочерние ссылки или нет. Если дочерние ссылки имеют формат 
`/article/2498201`, то передаем `"url_is_not_full": true`, тогда у нас сохранится полная ссылка.

```attributes``` - Слайс объектов с данными, в котором необходимо указать названия `div` и `a` классов, внутри которых 
находятся ссылки на дочерние страницы.

```child_attributes``` - Объект внутри которого указываем название `div`, `title` и `p` класса заголовка и описания новости.

## Примеры

Пример парсинга новостей для mail.ru

```
{
	"data": {
		"link": "https://news.mail.ru/",
		"attributes": [
			{
				"div_class": "daynews__item",
				"a_class": "photo"
			},
			{
				"div_class": "list__item",
				"a_class": "list__text"
			},
			{
				"div_class": "cols__inner",
				"a_class": "link-holder"
			},
			{
				"div_class": "list__item",
				"a_class": "link_flex"
			}
		],
		"child_attributes": {
			"child_div_class": "layout",
			"class_title": "hdr_collapse",
			"class_description": "article__item_html"
		}
	}
}
```


Пример парсинга новостей для vesti.ru

```
{
	"data": {
		"link": "https://www.vesti.ru/",
		"url_is_not_full": true,
		"attributes": [
			{
				"div_class": "promo__item",
				"a_class": "promo__pic-wrapper"
			},
			{
				"div_class": "section",
				"a_class": "section__pic-wrapper"
			}
		],
		"child_attributes": {
			"child_div_class": "content__article",
			"class_title": "article__title",
			"class_description": "js-mediator-article"
		}
	}
}
```

## Важно

Если вы хотите спарсить больше 20 дочерних ссылок, то необходимо поставить env переменную `DELAY` - она имитирует задержку
перед каждым запросом на дочернюю страницу, от 0 до числа который вы передадите в переменную `DELAY`, 
что позволяет не получать 429 код ошибки. По дефолту задержка не используется.
Рекомендуемая величина проставление переменной `DELAY=3` - так как на большинстве новостных сайтах, при такой задержке, 
можно без проблем получить данные. Так же вы можете парсить страницу частями, что будет быстрее.